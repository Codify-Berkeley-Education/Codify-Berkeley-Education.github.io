"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[109],{746:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>o,metadata:()=>a,toc:()=>d});var i=n(4848),t=n(8453);const o={title:"14.1 - Session Based Authentication and Oauth Providers",metadata:["Can be provided",{as:"objects",or:"arrays"}]},r="14.1 - Session Based Authentication and Oauth Providers",a={id:"Readings/authentication-and-middleware/14.1",title:"14.1 - Session Based Authentication and Oauth Providers",description:"In a backend system, authentication and middleware are critical components that ensure security, proper request handling, and smooth communication between the client and server.",source:"@site/docs/Readings/14-authentication-and-middleware/14.1.md",sourceDirName:"Readings/14-authentication-and-middleware",slug:"/Readings/authentication-and-middleware/14.1",permalink:"/docs/Readings/authentication-and-middleware/14.1",draft:!1,unlisted:!1,editUrl:"https://github.com/CS61D/website/tree/main/docs/Readings/14-authentication-and-middleware/14.1.md",tags:[],version:"current",frontMatter:{title:"14.1 - Session Based Authentication and Oauth Providers",metadata:["Can be provided",{as:"objects",or:"arrays"}]},sidebar:"tutorialSidebar",previous:{title:"Lecture 14 - Authentication and Middleware",permalink:"/docs/Readings/authentication-and-middleware/"},next:{title:"14.2 - NextAuth Overview and Session Information",permalink:"/docs/Readings/authentication-and-middleware/14.2"}},c={},d=[{value:"What is Authentication?",id:"what-is-authentication",level:2},{value:"Roles of Authentication in the Backend",id:"roles-of-authentication-in-the-backend",level:3},{value:"Common Use Cases",id:"common-use-cases",level:3},{value:"What is Middleware?",id:"what-is-middleware",level:2},{value:"Roles of Middleware in the Backend",id:"roles-of-middleware-in-the-backend",level:3},{value:"Common Use Cases",id:"common-use-cases-1",level:3},{value:"Session-Based and OAuth Providers",id:"session-based-and-oauth-providers",level:2},{value:"Session-Based Access",id:"session-based-access",level:3},{value:"How It Works",id:"how-it-works",level:4},{value:"Use Cases",id:"use-cases",level:4},{value:"Session-Based Access: Configuration Options",id:"session-based-access-configuration-options",level:4},{value:"OAuth Providers",id:"oauth-providers",level:3},{value:"How It Works",id:"how-it-works-1",level:4},{value:"Use Cases",id:"use-cases-1",level:4}];function l(e){const s={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components},{Details:n}=s;return n||function(e,s){throw new Error("Expected "+(s?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.h1,{id:"141---session-based-authentication-and-oauth-providers",children:"14.1 - Session Based Authentication and Oauth Providers"}),"\n",(0,i.jsxs)(s.p,{children:["In a backend system, ",(0,i.jsx)(s.strong,{children:"authentication"})," and ",(0,i.jsx)(s.strong,{children:"middleware"})," are critical components that ensure security, proper request handling, and smooth communication between the client and server."]}),"\n",(0,i.jsx)(s.h2,{id:"what-is-authentication",children:"What is Authentication?"}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Authentication"})," is the process of verifying the identity of a user or system. When a user tries to access a resource, the backend needs to confirm that they are who they claim to be. This prevents unauthorized access to sensitive data and resources."]}),"\n",(0,i.jsx)(s.h3,{id:"roles-of-authentication-in-the-backend",children:"Roles of Authentication in the Backend"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Identity Verification"}),": Ensures that the user is legitimate, usually through credentials like usernames and passwords, tokens, or API keys."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Access Control"}),": Once authenticated, the backend can control what the user is allowed to do based on their identity (this is known as ",(0,i.jsx)(s.strong,{children:"authorization"}),")."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Session Management"}),": Keeps track of the user's authenticated session, allowing them to continue interacting with the application without re-authenticating."]}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"common-use-cases",children:"Common Use Cases"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"User Login"}),": When a user logs in with their username and password."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"API Access"}),": Ensuring that API requests are coming from authorized users or systems."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Single Sign-On (SSO)"}),": Allowing users to log in once and gain access to multiple systems without re-entering credentials."]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"what-is-middleware",children:"What is Middleware?"}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Middleware"})," is software that acts as an intermediary between the server and the application logic. It intercepts requests and responses, allowing you to perform actions such as modifying the request, adding security layers, logging, or handling errors."]}),"\n",(0,i.jsx)(s.h3,{id:"roles-of-middleware-in-the-backend",children:"Roles of Middleware in the Backend"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Request/Response Manipulation"}),": Modify incoming requests or outgoing responses."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Security"}),": Implement authentication, authorization, and other security measures."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Logging"}),": Track requests, errors, and other important events."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Error Handling"}),": Catch and handle errors before they reach the application logic."]}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"common-use-cases-1",children:"Common Use Cases"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Authentication Middleware"}),": Checks if a user is authenticated before allowing access to certain routes."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Logging Middleware"}),": Logs each request for debugging and monitoring purposes."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"CORS Middleware"}),": Manages Cross-Origin Resource Sharing (CORS) to control which domains can access your resources."]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"session-based-and-oauth-providers",children:"Session-Based and OAuth Providers"}),"\n",(0,i.jsxs)(s.admonition,{type:"tip",children:[(0,i.jsx)(s.p,{children:"OAuth and session-based access are two ways to manage user access."}),(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Session-Based Access"})," is like having a key to a single door. When a user logs in, the server gives them a session key that keeps them logged in as they move around the website. This method is simple and works well if the user is staying on one site but can be tricky if you need to work across different sites or services."]}),(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"OAuth"})," is like using a master key that lets you access multiple doors without needing separate keys for each one. It\u2019s used when you want to allow an app to access your data on another service, like letting a fitness app see your Google Fit data. OAuth is good for connecting different services and for Single Sign-On (SSO), but it\u2019s more complex to set up compared to session-based authentication."]})]}),"\n",(0,i.jsx)(s.h3,{id:"session-based-access",children:"Session-Based Access"}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Session-Based Access"})," is one of the most traditional forms of authentication. It involves creating a session on the server after the user successfully logs in."]}),"\n",(0,i.jsx)(s.h4,{id:"how-it-works",children:"How It Works"}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"User Logs In"}),": The user submits their credentials (username and password) to the server."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Session Created"}),": If the credentials are correct, the server creates a session, typically storing the session ID in memory or a database."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Session ID Stored in Cookie"}),": The server sends the session ID back to the client, usually stored in a cookie."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Subsequent Requests"}),": For each subsequent request, the client sends the session ID cookie, allowing the server to identify the user."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Session Expiry"}),": Sessions can expire after a certain period, requiring the user to log in again."]}),"\n"]}),"\n",(0,i.jsx)(s.h4,{id:"use-cases",children:"Use Cases"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Web Applications"}),": Commonly used in web apps where the server maintains user session states."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Internal Systems"}),": Often used in corporate or internal applications where security is managed centrally."]}),"\n"]}),"\n",(0,i.jsxs)(n,{children:[(0,i.jsx)("summary",{children:"Example: Express Session Middleware"}),(0,i.jsxs)(s.p,{children:["In an Express.js application, you can use ",(0,i.jsx)(s.code,{children:"express-session"})," to manage sessions:"]}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-typescript",children:'import session from "express-session";\n\napp.use(\n  session({\n    secret: "your-secret-key",\n    resave: false,\n    saveUninitialized: true,\n    cookie: { secure: true },\n  }),\n);\n'})}),(0,i.jsx)(s.h4,{id:"session-based-access-configuration-options",children:"Session-Based Access: Configuration Options"}),(0,i.jsxs)(s.p,{children:["In the ",(0,i.jsx)(s.code,{children:"express-session"})," middleware configuration, you can specify several options to control session behavior:"]}),(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:(0,i.jsx)(s.code,{children:"secret"})}),": A secret key to sign the session ID cookie. This ensures the cookie's integrity and protects it from tampering."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:(0,i.jsx)(s.code,{children:"resave"})}),": Forces the session to be saved back to the session store, even if it wasn't modified. This is useful to ensure that the session data is always up-to-date."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:(0,i.jsx)(s.code,{children:"saveUninitialized"})}),': Forces a session that is "uninitialized" to be saved to the store. This is useful if you want to create a session for every request, even if the user has not interacted with the session.']}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:(0,i.jsx)(s.code,{children:"cookie"})}),": Configures the session ID cookie, including its security settings. You can set options like ",(0,i.jsx)(s.code,{children:"secure"}),", ",(0,i.jsx)(s.code,{children:"httpOnly"}),", and ",(0,i.jsx)(s.code,{children:"maxAge"})," to control the cookie's behavior."]}),"\n"]})]}),"\n",(0,i.jsx)(s.h3,{id:"oauth-providers",children:"OAuth Providers"}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"OAuth"})," is an open standard for access delegation. It allows websites or applications to access a user's data without exposing their credentials. OAuth is commonly used for Single Sign-On (SSO) and for authorizing third-party applications to access a user's data."]}),"\n",(0,i.jsx)(s.h4,{id:"how-it-works-1",children:"How It Works"}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"User Initiates OAuth Flow"}),': The user clicks a "Login with Google/Facebook" button.']}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Redirect to OAuth Provider"}),": The user is redirected to the OAuth provider (e.g., Google) to authenticate."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Authorization Code"}),": If the user consents, the OAuth provider redirects back to your application with an authorization code."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Exchange for Token"}),": Your application exchanges this authorization code for an access token."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Access API with Token"}),": The access token is used to authenticate API requests on behalf of the user."]}),"\n"]}),"\n",(0,i.jsx)(s.h4,{id:"use-cases-1",children:"Use Cases"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Social Media Integration"}),": Allowing users to log in with their social media accounts (Google, Facebook, Twitter)."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Third-Party API Access"}),": Authorizing third-party apps to access your account data (e.g., allowing an app to post on your behalf on Twitter)."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Single Sign-On (SSO)"}),": Implementing single sign-on across multiple services, allowing users to log in once and gain access to multiple applications."]}),"\n"]}),"\n",(0,i.jsxs)(n,{children:[(0,i.jsx)("summary",{children:"Example: Using OAuth with Passport.js"}),(0,i.jsx)(s.p,{children:"Passport.js is a popular middleware for authentication in Node.js, supporting various OAuth strategies."}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-typescript",children:'import passport from "passport";\nimport { Strategy as GoogleStrategy } from "passport-google-oauth20";\n\npassport.use(\n  new GoogleStrategy(\n    {\n      clientID: "YOUR_GOOGLE_CLIENT_ID",\n      clientSecret: "YOUR_GOOGLE_CLIENT_SECRET",\n      callbackURL: "http://yourdomain.com/auth/google/callback",\n    },\n    function (accessToken, refreshToken, profile, done) {\n      // Logic to find or create the user in your database\n      return done(null, profile);\n    },\n  ),\n);\n\n// Route to initiate OAuth flow\napp.get(\n  "/auth/google",\n  passport.authenticate("google", { scope: ["profile", "email"] }),\n);\n\n// OAuth callback route\napp.get(\n  "/auth/google/callback",\n  passport.authenticate("google", { failureRedirect: "/login" }),\n  function (req, res) {\n    // Successful authentication, redirect home.\n    res.redirect("/");\n  },\n);\n'})}),(0,i.jsx)(s.p,{children:"In this Example:"}),(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:(0,i.jsx)(s.code,{children:"GoogleStrategy"})}),": Configures Passport to use Google OAuth 2.0 for authentication."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:(0,i.jsx)(s.code,{children:"passport.authenticate"})}),": Handles the OAuth flow by redirecting users to Google for authentication and processing the callback."]}),"\n"]})]}),"\n",(0,i.jsx)(s.hr,{})]})}function h(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>r,x:()=>a});var i=n(6540);const t={},o=i.createContext(t);function r(e){const s=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),i.createElement(o.Provider,{value:s},e.children)}}}]);