<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Assignments/trpc" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.2.1">
<title data-rh="true">7. tRPC, React Query, and Next Auth | 61D: Applied Software Development</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://codify-berkeley-education.github.io/img/brackets.svg"><meta data-rh="true" name="twitter:image" content="https://codify-berkeley-education.github.io/img/brackets.svg"><meta data-rh="true" property="og:url" content="https://codify-berkeley-education.github.io/docs/Assignments/trpc"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="7. tRPC, React Query, and Next Auth | 61D: Applied Software Development"><meta data-rh="true" name="description" content="Assignment Links"><meta data-rh="true" property="og:description" content="Assignment Links"><link data-rh="true" rel="icon" href="/img/brackets.svg"><link data-rh="true" rel="canonical" href="https://codify-berkeley-education.github.io/docs/Assignments/trpc"><link data-rh="true" rel="alternate" href="https://codify-berkeley-education.github.io/docs/Assignments/trpc" hreflang="en"><link data-rh="true" rel="alternate" href="https://codify-berkeley-education.github.io/docs/Assignments/trpc" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://NRGKLBJ96F-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="61D: Applied Software Development" href="/opensearch.xml">
<link rel="preconnect" href="https://us.i.posthog.com">
<script>!function(t,e){var o,s,r,a;e.__SV||(window.posthog=e,e._i=[],e.init=function(i,n,p){function c(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(r=t.createElement("script")).type="text/javascript",r.async=!0,r.src=n.api_host.replace(".i.posthog.com","-assets.i.posthog.com")+"/static/array.js",(a=t.getElementsByTagName("script")[0]).parentNode.insertBefore(r,a);var g=e;for(void 0!==p?g=e[p]=[]:p="posthog",g.people=g.people||[],g.toString=function(t){var e="posthog";return"posthog"!==p&&(e+="."+p),t||(e+=" (stub)"),e},g.people.toString=function(){return g.toString(1)+".people (stub)"},o="capture identify alias people.set people.set_once set_config register register_once unregister opt_out_capturing has_opted_out_capturing opt_in_capturing reset isFeatureEnabled onFeatureFlags getFeatureFlag getFeatureFlagPayload reloadFeatureFlags group updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures getActiveMatchingSurveys getSurveys onSessionId".split(" "),s=0;s<o.length;s++)c(g,o[s]);e._i.push([i,n,p])},e.__SV=1)}(document,window.posthog||[]),posthog.init("DEV",{api_host:"https://us.i.posthog.com",id:"default"})</script><link rel="stylesheet" href="/assets/css/styles.c5bf4533.css">
<script src="/assets/js/runtime~main.a70c04ae.js" defer="defer"></script>
<script src="/assets/js/main.e156d83d.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"dark")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/brackets.svg" alt="61D Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/brackets.svg" alt="61D Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">61D</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/setup">Content</a><a class="navbar__item navbar__link" href="/overview">Course Overview</a><a class="navbar__item navbar__link" href="/syllabus">Syllabus</a><a class="navbar__item navbar__link" href="/docs/glossary">Glossary</a></div><div class="navbar__items navbar__items--right"><a href="https://www.youtube.com/channel/UCn-nlwUrJYsQs1fvAdLXNnA" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">YouTube<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/CS61D" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/setup">Course Setup</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/glossary">Glossary</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/Assignments/git-md-bash">Assignments</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Assignments/git-md-bash">0. Git, Markdown, and Bash</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Assignments/javascript">1. JavaScript</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Assignments/typescript">2. Typescript</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Assignments/react-todo">3. React</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Assignments/tailwind">4. Tailwind CSS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Assignments/forms">5. Forms</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Assignments/database">6. Databases</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/Assignments/trpc">7. tRPC, React Query, and Next Auth</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Assignments/nextjs">8. Next.js</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Assignments/apis-and-webhooks">9. APIs and Webhooks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Assignments/cloud">10. Cloud and Deployment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Assignments/cd-cd-testing">11. CI/CD and Testing</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/Bonus/extensions">Bonus</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/Projects/proj-1-quickconvert">Projects</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/Readings/Fundamentals/0.1-git">Readings</a></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Assignments</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">7. tRPC, React Query, and Next Auth</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>7. tRPC, React Query, and Next Auth</h1>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="assignment-links">Assignment Links<a href="#assignment-links" class="hash-link" aria-label="Direct link to Assignment Links" title="Direct link to Assignment Links">​</a></h2>
<ul>
<li><a href="https://github.com/CS61D/Assignment-Starter-tRPC" target="_blank" rel="nofollow">Starter Code<span><img decoding="async" loading="lazy" src="/img/link-icons/github.svg" alt="github" class="github-icon img_ev3q" style="width:16px;height:16px;margin-left:0.25rem;vertical-align:baseline"></span></a></li>
<li><a href="https://voting.61d.org/" target="_blank" rel="nofollow">Finished Solution<span><span class="glossary-icon"> ↗</span></span></a>:</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="assignment-overview">Assignment Overview<a href="#assignment-overview" class="hash-link" aria-label="Direct link to Assignment Overview" title="Direct link to Assignment Overview">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="backstory">Backstory<a href="#backstory" class="hash-link" aria-label="Direct link to Backstory" title="Direct link to Backstory">​</a></h3>
<p>When it comes to big family gatherings or outings with a group of friends, deciding on a restaurant or activity can be a challenging. Everyone has their own ranking of their preferences, and tabulating all of this fairly can be a chore. Therefore, you have decided to build a web application which allows you to implement <a href="https://fairvote.org/our-reforms/ranked-choice-voting/" target="_blank" rel="nofollow">ranked choice voting<span><span class="glossary-icon"> ↗</span></span></a>.</p>
<p>&quot;Voters have the option to rank candidates in order of preference: first, second, third and so forth. If your first choice doesn’t have a chance to win, your ballot counts for your next choice.&quot; --fairvote.org</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-vote">Example Vote<a href="#example-vote" class="hash-link" aria-label="Direct link to Example Vote" title="Direct link to Example Vote">​</a></h3>
<p>Imagine three students are running for class president: Alice, Bob, and Charlie. You are one of five students who get to vote, and the other four voters have already ranked the candidates as follows:</p>
<table><tr><th></th><th>Alice</th><th>Bob</th><th>Charlie</th></tr><tr><td>Voter 1</td><td>1st choice</td><td>2nd choice</td><td>3rd choice</td></tr><tr><td>Voter 2</td><td>1st choice</td><td>2nd choice</td><td>3rd choice</td></tr><tr><td>Voter 3</td><td>2nd choice</td><td>1st choice</td><td>3rd choice</td></tr><tr><td>Voter 4</td><td>2nd choice</td><td>1st choice</td><td>3rd choice</td></tr></table>
<p>If you rank Alice or Bob as your first choice, they will have a majority of first place votes in the first round, and win the election. However, even if you rank Charlie as your first choice, your relative preferences will still decide the election between Alice and Bob. Charlie will be eliminated in the first round, vote will be cast for your second preference in the final round.</p>
<p>You can use the <a href="https://voting.61d.org/" target="_blank" rel="nofollow">finished solution<span><span class="glossary-icon"> ↗</span></span></a> to simulate this election. Click &quot;Create Sample Room&quot; and cast your votes in the newly created election. You can do this multiple times to test multiple outcomes.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ranked-choice-algorithm">Ranked Choice Algorithm<a href="#ranked-choice-algorithm" class="hash-link" aria-label="Direct link to Ranked Choice Algorithm" title="Direct link to Ranked Choice Algorithm">​</a></h3>
<p>The actual ranked choice voting algorithm is implemented for you in the <code>calculateResults</code> function, and can be found in <code>src/server/api/routers/room/roomHelpers.ts</code>. The algorithm eliminates one voting item per round, until a voting item has greater than 50% of the votes. Tie, either for what voting item gets eliminated, or for the winner in the case of an exact 50-50 split, are simply broken by the timestamp in which the voting item was created.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="assignment-pieces">Assignment Pieces<a href="#assignment-pieces" class="hash-link" aria-label="Direct link to Assignment Pieces" title="Direct link to Assignment Pieces">​</a></h3>
<p>As this is a backend &quot;business logic&quot; focused assignment, the entire frontend and database schema have more or less been implemented for you. You will implement three main features:</p>
<ol>
<li>
<p>Authentication setup using Next Auth: In any voting system, it is important that people can only vote once. Therefore, we will require users to sign in with their google account so that we can verify their identity. Most of the heavy lifting is done for you, but you will need to set up the google OAuth client ID and secret.</p>
</li>
<li>
<p>tRPC API: You will use tRPC to build out the API for the voting system.</p>
<ol>
<li>Rooms: Creating a voting room and adding emails of the users allowed to access the room.</li>
<li>Voting items: Create &quot;candidates&quot; or other items which can be voted on</li>
<li>Votes and scoring: Keep track of each user&#x27;s ranking of each candidate. Once all votes are cast, calculate the winner using ranked choice voting.</li>
</ol>
</li>
<li>
<p>React Query: Once the API is built, you will use React Query to fetch the data from the API and display it on the frontend, and to submit data from the frontend.</p>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="invariants">Invariants<a href="#invariants" class="hash-link" aria-label="Direct link to Invariants" title="Direct link to Invariants">​</a></h3>
<p>We are not going to perfectly design a system that can handle all edge cases (we will offer some of these as optional extensions). With that in mind, we will make the following assumptions:</p>
<ol>
<li>Each room will be in one of three stages, &quot;open&quot;, &quot;voting&quot;, or &quot;complete&quot;. You will only have to handle certain operations in each stage, and other operations will be disabled.</li>
<li>The list of allowed emails will be set when the room is created, and cannot be changed. (Adding more emails is a bonus feature, see <a href="#add-additional-users-to-room-in-open-stage">optional extensions</a>)</li>
<li>Voting items can only be added when the room is in the &quot;open&quot; stage. They can not be deleted after being created, and they can only be created in the &quot;open&quot; stage.</li>
<li>Votes will be cast in the &quot;voting&quot; stage. A user will either have a ranking for all of the candidates, or no ranking at all. Users can change their votes until the room is in the &quot;complete&quot; stage. If an user is invited to a room, but never joins the room during the voting stage, they will not have any votes cast for them.</li>
<li>The winner will be calculated in the &quot;complete&quot; stage. Nothing can change about the room after this stage.</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="setup">Setup<a href="#setup" class="hash-link" aria-label="Direct link to Setup" title="Direct link to Setup">​</a></h3>
<p>Copy and paste these commands into your terminal to create environment variables, install dependencies, create a sqlite database, and apply the schema. <strong>Make sure to run this in the root of the project to ensure the database is created in the correct location.</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">cp .env.example .env # Copy the example environment variables</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">touch ./src/server/db/db.sqlite # Create a sqlite database</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">bun install # Install dependencies</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">bun db:push # Apply the schema to the database</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="part-1-authentication">Part 1: Authentication<a href="#part-1-authentication" class="hash-link" aria-label="Direct link to Part 1: Authentication" title="Direct link to Part 1: Authentication">​</a></h2>
<p>Setup a google OAuth client ID and secret for your application. This will allow users to sign in with their google account. Follow the steps below, also shown in this quick <a href="https://youtu.be/8wKJPeey5WA" target="_blank" rel="nofollow">video<span><span class="glossary-icon"> ↗</span></span></a>.</p>
<ol>
<li>Go to the <a href="https://console.cloud.google.com/apis/credentials" target="_blank" rel="nofollow">google cloud console<span><span class="glossary-icon"> ↗</span></span></a>.</li>
<li>In the upper left hand corner, select the dropdown to create a new project.</li>
<li>Name the project, and select a destination.</li>
<li>Once the project is created, click &quot;Create Credentials&quot; and select &quot;OAuth client ID&quot;.</li>
<li>Click &quot;Configure Consent Screen.&quot; Select User Type External if you want to be able to sign in with any google account. Name the application, and provide your email address as the support email and developer contact email.</li>
<li>After configuring the consent screen, click &quot;Create Credentials&quot; and select &quot;OAuth client ID&quot; again. Select &quot;Web application&quot;.</li>
<li>Under &quot;Authorized JavaScript origins&quot;, add <code>http://localhost:3000</code> and under authorized &quot;Authorized redirect URIs&quot; add <code>http://localhost:3000/api/auth/callback/google</code>.</li>
<li>Click &quot;Create&quot; and copy the client ID and client secret to your .env file.</li>
<li>Under &quot;OAuth consent screen,&quot; click &quot;Publish App&quot; to allow any google account to log in to the application. Select &quot;User Type External&quot; to allow all google accounts to sign in to your application, and click &quot;Confirm&quot;.</li>
<li>Finally, generate a random secret which will be used to sign session cookies. Add this to the <code>NEXTAUTH_SECRET</code> environment variable in your .env file.</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">openssl rand -base64 32 # Generate a random secret</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="part-2-trpc-api">Part 2: tRPC API<a href="#part-2-trpc-api" class="hash-link" aria-label="Direct link to Part 2: tRPC API" title="Direct link to Part 2: tRPC API">​</a></h2>
<p>Implement the following tRPC procedures in <code>roomRouter.ts</code> and <code>voteRouter.ts</code>. Each question for parts two and three of this assignment will have a todo flag which looks like this:</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// TODO: 2.1: Create Room</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Each question will state which file you need to be edited to complete the question, however you can find the question quicker by doing a global search (cmd + shift + f on mac, ctrl + shift + f on windows) for the todo flag.</p>
<div class="theme-admonition theme-admonition-important admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>important</div><div class="admonitionContent_BuS1"><p>You may use either <a href="https://orm.drizzle.team/docs/rqb" target="_blank" rel="nofollow">drizzle queries<span><span class="glossary-icon"> ↗</span></span></a> or <a href="https://orm.drizzle.team/docs/select" target="_blank" rel="nofollow">drizzle SQL select<span><span class="glossary-icon"> ↗</span></span></a> syntax to query the database for all steps except <a href="#27-get-my-votes">2.7</a>. This is because the format in which relational data is returned is slightly different between the two methods, and the frontend expects the data in a particular format.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="running-your-procedures">Running your procedures<a href="#running-your-procedures" class="hash-link" aria-label="Direct link to Running your procedures" title="Direct link to Running your procedures">​</a></h3>
<p>In order to run your procedures before building out the frontend, you can visit <a href="http://localhost:3000/api/panel" target="_blank" rel="nofollow">localhost:3000/api/panel<span><span class="glossary-icon"> ↗</span></span></a> to view all implemented procedures, and run them. You should see a ui similar to the one below, automatically generated by the <a href="https://github.com/aidansunbury/trpc-ui" target="_blank" rel="nofollow">trpc-ui<span><img decoding="async" loading="lazy" src="/img/link-icons/github.svg" alt="github" class="github-icon img_ev3q" style="width:16px;height:16px;margin-left:0.25rem;vertical-align:baseline"></span></a> package:</p>
<p><img decoding="async" loading="lazy" alt="trpc-panel" src="/assets/images/trpc-panel-a8eea071eab1252310c69f6cffe5cb91.png" width="1860" height="767" class="img_ev3q"></p>
<p>Also remember that you can inspect the contents of the database using <a href="https://local.drizzle.studio/" target="_blank" rel="nofollow">drizzle studio<span><span class="glossary-icon"> ↗</span></span></a></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">bun db:studio</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="21-create-room">2.1: Create Room<a href="#21-create-room" class="hash-link" aria-label="Direct link to 2.1: Create Room" title="Direct link to 2.1: Create Room">​</a></h3>
<p>Your first procedure is scaffolded for you. We define a protected procedure which requires the user to be signed in to create a room, pass a zod validator to the input method to validate the input, and finally indicate that the procedure will change some data on the server by using the mutation method as opposed to the query method.</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> createRoom </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;./roomValidator&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> protectedProcedure </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@/server/api/trpc&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">export</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> roomRouter </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">createTRPCRouter</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  create</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> protectedProcedure</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">input</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">createRoom</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">mutation</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">async</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> input </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token comment" style="color:rgb(106, 153, 85)">// TODO: 2.1: Create Room</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Insert a new room into the database. Use the provided name, and add the email of the user who called the procedure to the list of allowed emails. The room should be in the &quot;open&quot; stage. If the room is not created successfully, throw a trpc error with code INTERNAL_SERVER_ERROR. Otherwise return the created room.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>The emails are passed as an array of strings, but sqlite does not support arrays natively. As a result, store the emails in a comma separated string. Use the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/join" target="_blank" rel="nofollow">join<span><span class="glossary-icon"> ↗</span></span></a> method to accomplish this.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="22-get-room">2.2: Get Room<a href="#22-get-room" class="hash-link" aria-label="Direct link to 2.2: Get Room" title="Direct link to 2.2: Get Room">​</a></h3>
<p>Make a <code>get</code> protectedProcedure using the <code>withRoom</code> zod validator to create a procedure which fetches a room by its id. If the room does not exist, or the user does not have access to the room, throw a trpc error with the appropriate <a href="https://trpc.io/docs/server/error-handling#error-codes" target="_blank" rel="nofollow">trpc error code<span><span class="glossary-icon"> ↗</span></span></a>. Think about which error code makes most sense for each scenario, and then open the dropdown below to see the correct answers.</p>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Error Codes</summary><div><div class="collapsibleContent_i85q"><p>If the room does not exist, throw a trpc error with code <code>NOT_FOUND</code>. This is equivalent to a 404 error in a REST API. If the user is not allowed to access the room, throw a trpc error with code <code>FORBIDDEN</code>. This is equivalent to a 403 error in a REST API.</p></div></div></details>
<p>At this point, you should be able to create a room, and then get it. Start the server with <code>bun dev</code> and use the tRPC panel to create a room, and then get it.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="23-room-middleware">2.3: Room Middleware<a href="#23-room-middleware" class="hash-link" aria-label="Direct link to 2.3: Room Middleware" title="Direct link to 2.3: Room Middleware">​</a></h3>
<p>If you think about the remaining procedures we need to implement, every single one will require us to first check that the user calling the procedure is allowed to access the room. Instead of repeating this logic in every procedure, we can create a middleware which will check this for us. It will work similarly to how the <code>protectedProcedure</code> middleware first checks that the user is signed in, and then adds the user to the context of the request.</p>
<p>Use the code you wrote in 2.2 to fill in the <code>roomProcedure</code> middleware in <code>trpc.ts</code>. Notice that the roomProcedure middleware starts off by calling the <code>protectedProcedure</code> middleware.</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">export</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> roomProcedure </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> protectedProcedure</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">use</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Middleware body</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This means that all roomProcedures will also be protected procedures. Also note that we return the fetched room in the request context.</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// The next function passes the request onto the &quot;next&quot; item in the middleware</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// chain, in this case the procedure itself.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">return</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">next</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  ctx</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    room</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> requestedRoom</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>After implementing the roomProcedure middleware, rewrite the get procedure to use the middleware. The procedure will infer that the room is already a part of the context based on the middleware.</p>
<p><img decoding="async" loading="lazy" alt="context" src="/assets/images/roomProcedure-middleware-936615867a02d0ebdee95267fa411ba5.png" width="1326" height="282" class="img_ev3q"></p>
<p>For all future procedures, use the roomProcedure middleware to check that the user is allowed to access the room.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="24-add-voting-item">2.4: Add Voting Item<a href="#24-add-voting-item" class="hash-link" aria-label="Direct link to 2.4: Add Voting Item" title="Direct link to 2.4: Add Voting Item">​</a></h3>
<p>After creating a room, the next thing we need to support is adding voting items to the room. Implement <code>addVotingItem</code> in <code>voteRouter.ts</code>, which will create a voting item with the provided input. The voting item roomId should be taken from the request context.</p>
<p>The input to the procedure should be all of the fields of a votingItem. We could define this zod validator manually, but it is easier and more maintainable to use <a href="https://orm.drizzle.team/docs/zod" target="_blank" rel="nofollow">drizzle zod<span><span class="glossary-icon"> ↗</span></span></a> to generate the validator programmatically from our database schema.</p>
<p>Additionally, we only want to allow voting items to be added when the room is in the &quot;open&quot; stage. If the room in the request context is not in the &quot;open&quot; stage, throw a trpc error with code <code>BAD_REQUEST</code>. If the voting item is not created successfully, throw a trpc error with code <code>INTERNAL_SERVER_ERROR</code>. Otherwise return the created voting item.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="25-get-voting-items">2.5: Get Voting Items<a href="#25-get-voting-items" class="hash-link" aria-label="Direct link to 2.5: Get Voting Items" title="Direct link to 2.5: Get Voting Items">​</a></h3>
<p>Implement <code>getVotingItems</code> in <code>roomRouter.ts</code>. This procedure should return all voting items for the room in the request context in any order.</p>
<p>You should now be able to create a room, add voting items to the room, and get the voting items for the room. Use the tRPC panel to test these procedures.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="26-advance-stage">2.6: Advance Stage<a href="#26-advance-stage" class="hash-link" aria-label="Direct link to 2.6: Advance Stage" title="Direct link to 2.6: Advance Stage">​</a></h3>
<p>Implement <code>advanceStage</code> in <code>roomRouter.ts</code>. This procedure should advance the room in the request context to the next stage. The stages are &quot;open&quot;, &quot;voting&quot;, and &quot;complete&quot;. Use the provided helper <code>nextStatus</code> to return the next room status based on the current room status. If the room is not advanced successfully, throw a trpc error with code <code>INTERNAL_SERVER_ERROR</code>. Otherwise return the updated room.</p>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Bonus: Handle Edge Cases For Better UX</summary><div><div class="collapsibleContent_i85q"><p>The simple implementation of the <code>advanceStage</code> procedure which just moves the room to the next stage does get the job done, but it could lead to some unexpected behaviors.</p><ol>
<li>The room could be advanced to the &quot;voting&quot; stage without any voting items being created</li>
<li>The room could be advanced to the &quot;complete&quot; stage without any votes being cast</li>
<li>Two users sending simultaneous requests to advance the room to the next stage could cause the room to be advanced twice</li>
</ol><p>For the first two edge cases, you could add some additional checks to the procedure based on what stage the room is currently in. For the third edge case, you could require requests to specify which stage they are trying to advance the room to, and only allow the room to be advanced if the current stage is one less than the requested stage.</p><p>Any checks like these should occur on the server, as code executed on the client can be manipulated by the user. However, also performing these checks on the client in addition to the server allows for a smoother user experience. For example, if you were to prevent the room from advancing to the &quot;voting&quot; stage without any voting items being created, you could disable the &quot;Advance to Voting&quot; button on the client if there are no voting items in the room. If you only performed the check on the server, the user would have to submit the form, wait for a response from the server, and then be told that they need to add voting items to the room before advancing to the &quot;voting&quot; stage. By performing the check on the client, you can provide immediate feedback to the user and reduce the number of unnecessary requests to the server.</p></div></div></details>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="27-get-my-votes">2.7: Get My Votes<a href="#27-get-my-votes" class="hash-link" aria-label="Direct link to 2.7: Get My Votes" title="Direct link to 2.7: Get My Votes">​</a></h3>
<p>After the room advances to the voting stage, users will be presented with a drag and drop interface to rank the voting items. At some point, we need to create an initial vote for each user voting item pair in a room. We can either do this when the the room advances to the voting stage, or when the user first fetches their votes for a given room. Because not all allowed users are guaranteed to have created an account by the time the room advances (or ever), we will create with a default ordering when the user first fetches their votes. Therefore, even though server state is technically modified when the user first fetches their votes, we will consider this a query procedure not a mutation procedure.</p>
<ol>
<li>If the room is not in the voting stage, throw a trpc error with code <code>BAD_REQUEST</code>.</li>
<li>Get all voting items for the room in the request context. Also get all of the votes cast by the user in the room in the request context. If there is one vote for each voting item, return the fetched voting items and votes. Otherwise, create a vote for each voting item, and return the voting items and votes. When creating the votes, they can have any position order, as long as there is only one vote in each position.</li>
</ol>
<p>After the votes are created or fetched, ensure that they are returned to the client sorted in ascending order by position.</p>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>There are many ways to query data, with no right or wrong answer. Unfortunately, the frontend is written in a way that expects the data in a particular format. Therefore, make sure that you use a <a href="https://orm.drizzle.team/docs/select" target="_blank" rel="nofollow">drizzle select<span><span class="glossary-icon"> ↗</span></span></a> command instead of a <a href="https://orm.drizzle.team/docs/rqb" target="_blank" rel="nofollow">drizzle query<span><span class="glossary-icon"> ↗</span></span></a> command instead for this particular api route. The data you should be of the following format.</p><div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> votesWithVotingItems</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  vote</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    id</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(86, 156, 214)">string</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    userId</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(86, 156, 214)">string</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    roomId</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(86, 156, 214)">string</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    votingItemId</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(86, 156, 214)">string</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    position</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(86, 156, 214)">number</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  voting_item</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    id</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(86, 156, 214)">string</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    name</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(86, 156, 214)">string</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    description</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(86, 156, 214)">string</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    roomId</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(86, 156, 214)">string</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    createdAt</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(86, 156, 214)">number</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Hint 1: Planning Out the Function</summary><div><div class="collapsibleContent_i85q"><p>First, determine how you can create the votes for the user and voting items. Try implementing this and manually checking in the database that the votes are created as expected.</p><p>Next, assume that the votes have already been created, and write your database query to fetch the votes and voting items. Try selecting from the votingItem table, and left joining the vote table on the votingItemId and userId.</p><p>Putting these pieces together, your final function should have the following parts:</p><ol>
<li>Query the votes and voting items</li>
<li>If there is not a vote for each voting item, create a vote for each voting item and query the newly created votes and voting items</li>
<li>Return the votes and voting items. Either the initially fetched votes and voting items, or the newly created votes and voting items.</li>
</ol><p>Also remember that you can insert <a href="https://orm.drizzle.team/docs/insert#insert-multiple-rows" target="_blank" rel="nofollow">more than one vote at a time<span><span class="glossary-icon"> ↗</span></span></a>.</p></div></div></details>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Hint 2: Correct db query if you are completely stuck</summary><div><div class="collapsibleContent_i85q"><p>If you are completely blocked on the initial database query, this query will give you the data you need. After fetching this data, make sure that the vote is defined for each voting item, and if not, create a vote for each voting item.</p><div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> userVotesAndVotingItemsForRoom </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">await</span><span class="token plain"> db</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">select</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">from</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">votingItem</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">where</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token function" style="color:rgb(220, 220, 170)">eq</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">votingItem</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">roomId </span><span class="token operator" style="color:rgb(212, 212, 212)">??</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">room</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">leftJoin</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    vote</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">and</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token function" style="color:rgb(220, 220, 170)">eq</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">vote</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">votingItemId</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> votingItem</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token function" style="color:rgb(220, 220, 170)">eq</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">vote</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">userId</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">session</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">user</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">orderBy</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token function" style="color:rgb(220, 220, 170)">asc</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">vote</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">position</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></details>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="28-update-my-votes">2.8: Update My Votes<a href="#28-update-my-votes" class="hash-link" aria-label="Direct link to 2.8: Update My Votes" title="Direct link to 2.8: Update My Votes">​</a></h3>
<p>A user&#x27;s ranking of the voting items within a room will be passed to the server as a ordered list of vote ids. Implement <code>updateMyVotes</code> in <code>voteRouter.ts</code>, which will set the position value of each vote to be the index it appears in the inputted array.</p>
<p>We expect our votes to hold certain invariants, and we need to enforce these invariants in our procedure for the application to work correctly.</p>
<ol>
<li>In each call to <code>updateMyVotes</code>, the user must pass an array containing every vote id for the user in the room. For example, if there are four voting items, we expect exactly four ids to be passed.</li>
<li>Each vote must have a unique position. If there are four votes, one vote must have position 1, one vote must have position 2, one vote must have position 3, and one vote must have position 4.</li>
</ol>
<p>We can ensure that these data guarantees are enforced by using a transaction. All votes must be updated successfully for the transaction to commit. Additionally, the number of votes passed must be equal to the number of voting items in the room.</p>
<ol>
<li><a href="https://zod.dev/?id=merge" target="_blank" rel="nofollow">Merge<span><span class="glossary-icon"> ↗</span></span></a> the provided <code>voteIds</code> zod validator with the <code>withRoom</code> validator in the request input.</li>
<li>If the room is not in the voting stage, throw a trpc error with code <code>BAD_REQUEST</code>.</li>
<li>In a transaction, update each vote to have the position equal to the index it appears in the <code>voteIds</code> array (one indexed). If any of the votes fail to update, throw a trpc error with code <code>BAD_REQUEST</code>.</li>
<li>Fetch all voting items for the room, and ensure that the number of votes passed is equal to the number of voting items in the room. If too many or too few votes are passed, throw a trpc error with code <code>BAD_REQUEST</code>. Otherwise, commit the transaction return the updated votes.</li>
</ol>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>Make sure to one index (as opposed to zero index) the position, as the frontend expects the position to be one indexed.</p></div></div>
<p>The votes will be sorted by position in the client, so you do not need to worry about returning the votes in any particular order.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="29-get-results">2.9: Get Results<a href="#29-get-results" class="hash-link" aria-label="Direct link to 2.9: Get Results" title="Direct link to 2.9: Get Results">​</a></h3>
<p>Almost Done!</p>
<p>Implement <code>getResults</code> in <code>roomRouter.ts</code>, to calculate the winner.</p>
<ol>
<li>If the room is not in the &quot;complete&quot; stage, throw a trpc error with code BAD_REQUEST.</li>
<li>Select all voting items for the room, and all votes for the room. Then pass these to the provided <code>calculateResults</code> function and return the result. You will know that you are passing the correct values into <code>calculateResults</code> if you do not have any type errors.</li>
</ol>
<p>Congrats! You have now finished the backend for the ranked choice voting system. You should be able to create a room, add voting items to the room, advance the room to the voting stage, get your votes, update your votes, and get the results of the room. Use the tRPC panel to test these procedures before moving onto the next part.</p>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Bonus: Parallel Data Fetching</summary><div><div class="collapsibleContent_i85q"><p>It is tempting to always immediately await the result of an async function (or database call in this case) so that you more or less treat async code like slow running synchronous code. However, there are certain situations (like this function) where you need multiple independent async calls to complete before you can continue. We need to fetch all voting items and all votes before we can calculate the results, so we can await both of these calls in parallel.</p><p>In this case the difference between awaiting each call sequentially versus in parallel is unlikely to be noticed by the end user, but it is still good practice to await calls in parallel when possible. You can test out the performance difference by calling <a href="https://www.w3schools.com/jsref/met_console_time.asp" target="_blank" rel="nofollow">console.time()<span><span class="glossary-icon"> ↗</span></span></a>, and comparing the time it takes to fetch the data sequentially versus in parallel.</p><div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token builtin" style="color:rgb(86, 156, 214)">console</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">time</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;fetching data&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// your db calls</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token builtin" style="color:rgb(86, 156, 214)">console</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">timeEnd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;fetching data&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></details>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="part-3-react-query">Part 3: React Query<a href="#part-3-react-query" class="hash-link" aria-label="Direct link to Part 3: React Query" title="Direct link to Part 3: React Query">​</a></h2>
<p>Now that we have written our backend, we need to actually call our queries and mutations in our frontend. The parts of the application that require querying data are already wrapped in a <a href="https://react.dev/reference/react/Suspense" target="_blank" rel="nofollow">suspense boundary<span><span class="glossary-icon"> ↗</span></span></a> in <code>src/app/[roomId]/page.tsx</code>, meaning you can use <a href="https://trpc.io/docs/client/react/suspense#usesuspensequery" target="_blank" rel="nofollow">useSuspenseQuery<span><span class="glossary-icon"> ↗</span></span></a> without any additional setup. However if you prefer, you may also use <a href="https://trpc.io/docs/client/react/useQuery#example-usage" target="_blank" rel="nofollow">useQuery<span><span class="glossary-icon"> ↗</span></span></a> instead. However, if you use <code>useQuery</code> you will have to handle loading and error states yourself and it is generally easier to use <code>useSuspenseQuery</code>.</p>
<p>Although there are many places in which we need to fetch or submit data, often only a few lines of code are required. At this point you are through the vast majority of the assignment.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="31-create-room-mutation">3.1: Create Room Mutation<a href="#31-create-room-mutation" class="hash-link" aria-label="Direct link to 3.1: Create Room Mutation" title="Direct link to 3.1: Create Room Mutation">​</a></h3>
<p>Define a mutation to call <code>api.room.create</code> in <code>CreateRoom.tsx</code>. After defining the mutation hook, update the onSubmit function to call the mutation with the data from the form.</p>
<p>If the mutation is successful, we then want to redirect the user to the room they just created. Add an <code>onSuccess</code> handler to the mutation which will redirect the user to the route of the created room.</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">router</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">push</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token template-string template-punctuation string" style="color:rgb(206, 145, 120)">`</span><span class="token template-string string" style="color:rgb(206, 145, 120)">/</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(212, 212, 212)">${</span><span class="token template-string interpolation">createdRoomId</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token template-string template-punctuation string" style="color:rgb(206, 145, 120)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Finally, we want to make sure we don&#x27;t accidentally submit the room creation form twice while waiting for the mutation to complete. Use the <code>isPending</code> property of the mutation to disable the submit button while the mutation is pending.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>There are three <code>// TODO: 3.1</code> comments in <code>CreateRoom.tsx</code>. You need to fill something in for each of these comments.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="32-get-room-query">3.2: Get Room Query<a href="#32-get-room-query" class="hash-link" aria-label="Direct link to 3.2: Get Room Query" title="Direct link to 3.2: Get Room Query">​</a></h3>
<p>After redirecting to to the room page, we need to fetch the basic information about the room to display the name, description, and allowed emails. Replace the placeholder room object with a <a href="https://trpc.io/docs/client/react/suspense#usesuspensequery" target="_blank" rel="nofollow">suspense query<span><span class="glossary-icon"> ↗</span></span></a> to <code>api.room.get</code> in <code>src/app/[roomId]/page.tsx</code>. Pass in the roomId from the route parameters to the query. Route parameters will be covered in more detail in the NextJs part of the course.</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// On a route like http://localhost:3000/2295d230-1c38-4ad5-bbde-7aac0cf994be, the roomId will be &quot;2295d230-1c38-4ad5-bbde-7aac0cf994be&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:rgb(220, 220, 170)">RoomPage</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> params </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> params</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> roomId</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(86, 156, 214)">string</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// use roomId in the query</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// component body</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You should now be able to create a room in the UI, and view the basic room information.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="33-get-voting-items-query">3.3: Get Voting Items Query<a href="#33-get-voting-items-query" class="hash-link" aria-label="Direct link to 3.3: Get Voting Items Query" title="Direct link to 3.3: Get Voting Items Query">​</a></h3>
<p>Replace the placeholder empty array with a query to <code>api.room.getVotingItems</code> in <code>src/app/[roomId]/_components/VotingItems.tsx</code>. Pass in the roomId from the route parameters to the query the same way you did with 3.2.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="34-add-voting-item-mutation">3.4: Add Voting Item Mutation<a href="#34-add-voting-item-mutation" class="hash-link" aria-label="Direct link to 3.4: Add Voting Item Mutation" title="Direct link to 3.4: Add Voting Item Mutation">  ​</a></h3>
<p>Create a mutation to add a voting item. Like in <a href="#31-create-room-mutation">3.1</a>, you will need to define the mutation hook, and call the mutation function in the onSubmit handler. Once you have created the mutation, try using to add voting items to the room.</p>
<p>You will notice that even if our mutation is successful, the new voting item does not appear on the page. In order to get our desired behavior, we need to use one of core behaviors of React Query: Query Invalidations.</p>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Invalidation Explained</summary><div><div class="collapsibleContent_i85q"><p>The core building blocks of React Query are queries and mutations. Queries are retrieve data from the server, and <strong>do not</strong> modify any server side state. Mutations <strong>do</strong> modify server side state. After a mutation is successful, the data on the server and the client will be temporarily out of sync.</p><p>To remedy this, all we need to do is specify which queries are out of sync with the server after the successful mutation; we <strong>invalidate</strong> one or more queries. When a query is invalidated, React Query will refetch the data for that query, resyncing the data on the client with the updated server state.</p></div></div></details>
<p>Add an <code>onSuccess</code> handler to the mutation which invalidates the query to get voting items. This will cause the query to refetch the data, and the new voting item will appear on the page. Below is a modified example from the <a href="https://trpc.io/docs/client/react/useUtils#query-invalidation" target="_blank" rel="nofollow">trpc docs<span><span class="glossary-icon"> ↗</span></span></a>, showcasing how a successful post edit can trigger and invalidate the query to get all posts.</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> utils </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> api</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">useUtils</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// Get the utils object from the api</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Mutation to edit a post</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> mutation </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> api</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">post</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">edit</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">useMutation</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token function" style="color:rgb(220, 220, 170)">onSuccess</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    utils</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">post</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">all</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">invalidate</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// Invalidate the query to get all posts</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>After adding the query invalidation, ensure that newly added voting items appear on the page a short delay after they are created.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="35-refresh-voting-items">3.5: Refresh Voting Items<a href="#35-refresh-voting-items" class="hash-link" aria-label="Direct link to 3.5: Refresh Voting Items" title="Direct link to 3.5: Refresh Voting Items">​</a></h3>
<p>When another user in the room adds a voting item, we want to be able to refresh the voting items on the page without refreshing the entire page. Invalidate the query to get the voting items (the same invalidation you used in <a href="#34-add-voting-item-mutation">3.4</a>) in the <code>refreshVotingItems</code> event handler.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="36-advance-stage-mutation">3.6: Advance Stage Mutation<a href="#36-advance-stage-mutation" class="hash-link" aria-label="Direct link to 3.6: Advance Stage Mutation" title="Direct link to 3.6: Advance Stage Mutation">​</a></h3>
<p>Add a mutation to advance the stage of the room in <code>src/app/[roomId]/page.tsx</code>, and call the mutation in the <code>handleAdvanceStage</code> event handler. If the mutation is successful, invalidate the room query to refetch the room data with the updated stage.</p>
<p>It is also good to provide visual feedback to the user when a form submission is being processed. In this case, we do not want the user to click the &quot;Advance to Voting&quot; button multiple times while the room is being advanced. Destructure the <code>isPending</code> property from the mutation hook, and use it to conditionally disable the &quot;Advance Stage&quot; button while the mutation is pending. We are already disabling the button if the room is in the &quot;complete&quot; stage.</p>
<div class="language-tsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-tsx codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token tag punctuation" style="color:rgb(212, 212, 212)">&lt;</span><span class="token tag class-name" style="color:rgb(78, 201, 176)">Button</span><span class="token tag" style="color:rgb(78, 201, 176)"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token tag" style="color:rgb(78, 201, 176)">  </span><span class="token tag attr-name" style="color:rgb(156, 220, 254)">onClick</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:rgb(212, 212, 212)">=</span><span class="token tag script language-javascript punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token tag script language-javascript punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token tag script language-javascript punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token tag script language-javascript" style="color:rgb(78, 201, 176)"> </span><span class="token tag script language-javascript arrow operator" style="color:rgb(212, 212, 212)">=&gt;</span><span class="token tag script language-javascript" style="color:rgb(78, 201, 176)"> </span><span class="token tag script language-javascript function" style="color:rgb(220, 220, 170)">handleAdvanceStage</span><span class="token tag script language-javascript punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token tag script language-javascript punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token tag script language-javascript punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token tag" style="color:rgb(78, 201, 176)"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token tag" style="color:rgb(78, 201, 176)">  </span><span class="token tag comment" style="color:rgb(106, 153, 85)">// Also disable the button if the mutation is pending</span><span class="token tag" style="color:rgb(78, 201, 176)"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token tag" style="color:rgb(78, 201, 176)">  </span><span class="token tag attr-name" style="color:rgb(156, 220, 254)">disabled</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:rgb(212, 212, 212)">=</span><span class="token tag script language-javascript punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token tag script language-javascript" style="color:rgb(78, 201, 176)">room</span><span class="token tag script language-javascript punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token tag script language-javascript property-access" style="color:rgb(78, 201, 176)">status</span><span class="token tag script language-javascript" style="color:rgb(78, 201, 176)"> </span><span class="token tag script language-javascript operator" style="color:rgb(212, 212, 212)">===</span><span class="token tag script language-javascript" style="color:rgb(78, 201, 176)"> </span><span class="token tag script language-javascript string" style="color:rgb(206, 145, 120)">&quot;complete&quot;</span><span class="token tag script language-javascript punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token tag" style="color:rgb(78, 201, 176)"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token tag" style="color:rgb(78, 201, 176)">  </span><span class="token tag attr-name" style="color:rgb(156, 220, 254)">variant</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(212, 212, 212)">=</span><span class="token tag attr-value punctuation" style="color:rgb(212, 212, 212)">&quot;</span><span class="token tag attr-value" style="color:rgb(206, 145, 120)">outline</span><span class="token tag attr-value punctuation" style="color:rgb(212, 212, 212)">&quot;</span><span class="token tag" style="color:rgb(78, 201, 176)"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token tag" style="color:rgb(78, 201, 176)"></span><span class="token tag punctuation" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain-text">  Advance stage</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain-text"></span><span class="token tag punctuation" style="color:rgb(212, 212, 212)">&lt;/</span><span class="token tag class-name" style="color:rgb(78, 201, 176)">Button</span><span class="token tag punctuation" style="color:rgb(212, 212, 212)">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="37-get-votes-query">3.7: Get Votes Query<a href="#37-get-votes-query" class="hash-link" aria-label="Direct link to 3.7: Get Votes Query" title="Direct link to 3.7: Get Votes Query">​</a></h3>
<p>Replace the temporary empty <code>myVotes</code> array with a suspense query to fetch the logged in user&#x27;s votes from the backend.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="38-update-voting-items-mutation">3.8: Update Voting Items Mutation<a href="#38-update-voting-items-mutation" class="hash-link" aria-label="Direct link to 3.8: Update Voting Items Mutation" title="Direct link to 3.8: Update Voting Items Mutation">​</a></h3>
<p>Add a mutation to update the user&#x27;s votes. Call the mutation after the client has reordered the voting items (where the second 3.8 TODO flag is). The <code>newVotes</code> array is an array of votes with their associated voting items in the order they should be saved. Remember that <code>updateMyVotes</code> procedure only takes an array of vote ids, so you will need to map the <code>newVotes</code> array to an array of vote ids.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="39-get-results-query">3.9: Get Results Query<a href="#39-get-results-query" class="hash-link" aria-label="Direct link to 3.9: Get Results Query" title="Direct link to 3.9: Get Results Query">​</a></h3>
<p>Replace the temporary empty <code>results</code> array with a call to <code>api.room.getResults</code> in <code>src/app/[roomId]/_components/Results.tsx</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="310-join-room">3.10: Join Room<a href="#310-join-room" class="hash-link" aria-label="Direct link to 3.10: Join Room" title="Direct link to 3.10: Join Room">​</a></h3>
<p>When a user enters a roomId to join, we first want to make sure that the user is allowed to join before attempting to redirect them. We could pass the entered room id into a typical <code>useQuery</code> call, but this would trigger a new call to the server every time the user enters a new character. We need to fetch the data using our procedure, but only when the user submits the form and not right when the page loads.</p>
<p>Fortunately, trpc provides a fetch utility which allows us to trigger a single call to the server without using a <code>useQuery</code>. Remove the &quot;Not Implemented&quot; toast notification and replace it with a one time fetch to <code>api.room.get</code> in <code>src/app/_components/JoinRoom.tsx</code>.</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> utils </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> api</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">useUtils</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> room </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">await</span><span class="token plain"> utils</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">room</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">get</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">fetch</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> roomId</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">roomId </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// Fetch utility function</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">router</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">push</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token template-string template-punctuation string" style="color:rgb(206, 145, 120)">`</span><span class="token template-string string" style="color:rgb(206, 145, 120)">/</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(212, 212, 212)">${</span><span class="token template-string interpolation">room</span><span class="token template-string interpolation punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token template-string interpolation">id</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token template-string template-punctuation string" style="color:rgb(206, 145, 120)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// Redirect to the room page</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If the procedure returns a trpc error, we will catch the error and display a toast notification with the error message. If the procedure is successful, add we will redirect the user to the room page.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="311-invalidate-room-on-failed-requests">3.11: Invalidate Room On Failed Requests<a href="#311-invalidate-room-on-failed-requests" class="hash-link" aria-label="Direct link to 3.11: Invalidate Room On Failed Requests" title="Direct link to 3.11: Invalidate Room On Failed Requests">​</a></h3>
<p>In addition to triggering actions on successful mutations, we can <a href="https://tanstack.com/query/latest/docs/framework/react/guides/mutations#mutation-side-effects" target="_blank" rel="nofollow">also trigger actions on failed mutations<span><span class="glossary-icon"> ↗</span></span></a>. If a user tries to add a voting item after another user has already advanced the room to the &quot;voting&quot; stage, their request will fail. Similarly, if a user tries to update their votes after the room has advanced to the &quot;complete&quot; stage, their request will fail. In both of these cases, we need to invalidate the room query to refetch the room data with the updated stage.</p>
<p>Add an <code>onError</code> handler to the both the <a href="#38-update-voting-items-mutation">update my votes</a> and <a href="#34-add-voting-item-mutation">add voting item</a> mutations to invalidate the room query on a failed request. To test this, you will need to sign in with two different google accounts in two different browser windows.</p>
<p>Congratulations! You now have a fully functioning ranked choice voting application.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="optional-extensions">Optional Extensions<a href="#optional-extensions" class="hash-link" aria-label="Direct link to Optional Extensions" title="Direct link to Optional Extensions">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="add-additional-users-to-room-in-open-stage">Add Additional Users to Room in &quot;Open&quot; Stage<a href="#add-additional-users-to-room-in-open-stage" class="hash-link" aria-label="Direct link to Add Additional Users to Room in &quot;Open&quot; Stage" title="Direct link to Add Additional Users to Room in &quot;Open&quot; Stage">​</a></h3>
<p>For simplicity, we only added the ability to add voters to a room when it is created. However, there is no reason we shouldn&#x27;t be able to add voter to the room before voting starts.</p>
<ol>
<li>Add a procedure <code>addVoters</code> which accepts an array of new emails to add to the room. Make sure that duplicates are removed.</li>
<li>Create a dialog component <code>AddVoters.tsx</code> in the frontend that uses your <code>addVoters</code> mutation. You can copy the dialog code from <code>CreateRoom.tsx</code>. Make sure that the option to add voters is only visible or only enabled in the &quot;open&quot; stage. After submitting the mutation, you should invalidate the room to display the newly created. You can also display a <a href="https://ui.shadcn.com/docs/components/toast" target="_blank" rel="nofollow">toast notification<span><span class="glossary-icon"> ↗</span></span></a> when users are added successfully.</li>
</ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/CS61D/website/tree/main/docs/Assignments/trpc.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/Assignments/database"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">6. Databases</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/Assignments/nextjs"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">8. Next.js</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#assignment-links" class="table-of-contents__link toc-highlight">Assignment Links</a></li><li><a href="#assignment-overview" class="table-of-contents__link toc-highlight">Assignment Overview</a><ul><li><a href="#backstory" class="table-of-contents__link toc-highlight">Backstory</a></li><li><a href="#example-vote" class="table-of-contents__link toc-highlight">Example Vote</a></li><li><a href="#ranked-choice-algorithm" class="table-of-contents__link toc-highlight">Ranked Choice Algorithm</a></li><li><a href="#assignment-pieces" class="table-of-contents__link toc-highlight">Assignment Pieces</a></li><li><a href="#invariants" class="table-of-contents__link toc-highlight">Invariants</a></li><li><a href="#setup" class="table-of-contents__link toc-highlight">Setup</a></li></ul></li><li><a href="#part-1-authentication" class="table-of-contents__link toc-highlight">Part 1: Authentication</a></li><li><a href="#part-2-trpc-api" class="table-of-contents__link toc-highlight">Part 2: tRPC API</a><ul><li><a href="#running-your-procedures" class="table-of-contents__link toc-highlight">Running your procedures</a></li><li><a href="#21-create-room" class="table-of-contents__link toc-highlight">2.1: Create Room</a></li><li><a href="#22-get-room" class="table-of-contents__link toc-highlight">2.2: Get Room</a></li><li><a href="#23-room-middleware" class="table-of-contents__link toc-highlight">2.3: Room Middleware</a></li><li><a href="#24-add-voting-item" class="table-of-contents__link toc-highlight">2.4: Add Voting Item</a></li><li><a href="#25-get-voting-items" class="table-of-contents__link toc-highlight">2.5: Get Voting Items</a></li><li><a href="#26-advance-stage" class="table-of-contents__link toc-highlight">2.6: Advance Stage</a></li><li><a href="#27-get-my-votes" class="table-of-contents__link toc-highlight">2.7: Get My Votes</a></li><li><a href="#28-update-my-votes" class="table-of-contents__link toc-highlight">2.8: Update My Votes</a></li><li><a href="#29-get-results" class="table-of-contents__link toc-highlight">2.9: Get Results</a></li></ul></li><li><a href="#part-3-react-query" class="table-of-contents__link toc-highlight">Part 3: React Query</a><ul><li><a href="#31-create-room-mutation" class="table-of-contents__link toc-highlight">3.1: Create Room Mutation</a></li><li><a href="#32-get-room-query" class="table-of-contents__link toc-highlight">3.2: Get Room Query</a></li><li><a href="#33-get-voting-items-query" class="table-of-contents__link toc-highlight">3.3: Get Voting Items Query</a></li><li><a href="#34-add-voting-item-mutation" class="table-of-contents__link toc-highlight">3.4: Add Voting Item Mutation</a></li><li><a href="#35-refresh-voting-items" class="table-of-contents__link toc-highlight">3.5: Refresh Voting Items</a></li><li><a href="#36-advance-stage-mutation" class="table-of-contents__link toc-highlight">3.6: Advance Stage Mutation</a></li><li><a href="#37-get-votes-query" class="table-of-contents__link toc-highlight">3.7: Get Votes Query</a></li><li><a href="#38-update-voting-items-mutation" class="table-of-contents__link toc-highlight">3.8: Update Voting Items Mutation</a></li><li><a href="#39-get-results-query" class="table-of-contents__link toc-highlight">3.9: Get Results Query</a></li><li><a href="#310-join-room" class="table-of-contents__link toc-highlight">3.10: Join Room</a></li><li><a href="#311-invalidate-room-on-failed-requests" class="table-of-contents__link toc-highlight">3.11: Invalidate Room On Failed Requests</a></li></ul></li><li><a href="#optional-extensions" class="table-of-contents__link toc-highlight">Optional Extensions</a><ul><li><a href="#add-additional-users-to-room-in-open-stage" class="table-of-contents__link toc-highlight">Add Additional Users to Room in &quot;Open&quot; Stage</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/overview">Overview</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Build with Docusaurus</div></div></div></footer></div>
</body>
</html>